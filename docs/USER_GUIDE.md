# 蜂鸟自动化平台用户手册

欢迎使用蜂鸟自动化平台！本手册将帮助您快速上手并充分利用平台的各项功能。

## 📚 目录

1. [快速入门](#快速入门)
2. [用户界面介绍](#用户界面介绍)
3. [任务管理](#任务管理)
4. [工作流编辑器](#工作流编辑器)
5. [浏览器管理](#浏览器管理)
6. [监控与告警](#监控与告警)
7. [用户权限管理](#用户权限管理)
8. [系统设置](#系统设置)
9. [常见问题](#常见问题)

## 🚀 快速入门

### 首次登录

1. **访问系统**
   - 打开浏览器，访问您的蜂鸟平台地址
   - 例如：`http://your-domain.com` 或 `http://localhost`

2. **登录账号**
   - 默认管理员账号：`admin@example.com`
   - 默认密码：`password`
   - **重要**：首次登录后请立即修改密码

3. **修改密码**
   - 点击右上角用户头像
   - 选择"个人设置"
   - 在"安全设置"中修改密码

### 创建第一个任务

1. **进入任务管理**
   - 在左侧导航栏点击"任务管理"
   - 点击"创建任务"按钮

2. **填写基本信息**
   ```
   任务名称：我的第一个任务
   任务类型：浏览器自动化
   目标网址：https://www.example.com
   描述：这是我的第一个自动化任务
   ```

3. **配置执行计划**
   - 选择执行方式：立即执行 / 定时执行 / 手动触发
   - 如选择定时执行，设置 Cron 表达式，例如：`0 9 * * *`（每天上午9点）

4. **保存并执行**
   - 点击"保存"按钮
   - 点击"立即执行"测试任务

## 🖥️ 用户界面介绍

### 主要界面布局

```
┌─────────────────────────────────────────────────────────┐
│                    顶部导航栏                              │
├─────────────┬───────────────────────────────────────────┤
│             │                                           │
│   左侧      │              主内容区域                      │
│   导航菜单   │                                           │
│             │                                           │
│             │                                           │
└─────────────┴───────────────────────────────────────────┘
```

### 顶部导航栏

- **系统标题**：显示"蜂鸟自动化平台"
- **搜索框**：全局搜索任务、日志等
- **通知中心**：显示系统通知和告警
- **用户菜单**：个人设置、退出登录等

### 左侧导航菜单

- **仪表板**：系统概览和统计信息
- **任务管理**：创建、编辑、执行任务
- **工作流编辑器**：可视化工作流设计
- **执行历史**：查看任务执行记录
- **浏览器管理**：管理浏览器实例池
- **监控中心**：系统性能和任务监控
- **用户管理**：用户和权限管理
- **系统设置**：全局配置和参数

## 📋 任务管理

### 任务类型

#### 1. 浏览器自动化任务
- **用途**：网页操作、数据采集、UI测试
- **支持操作**：
  - 页面导航：访问URL、前进、后退、刷新
  - 元素操作：点击、输入、选择、拖拽
  - 数据提取：获取文本、属性、截图
  - 条件判断：元素存在性、文本匹配

#### 2. API 测试任务
- **用途**：接口测试、数据验证
- **支持方法**：GET、POST、PUT、DELETE
- **功能特性**：
  - 请求头设置
  - 参数配置
  - 响应验证
  - 数据断言

### 任务配置详解

#### 基本设置

```yaml
任务名称: 必填，任务的唯一标识
任务类型: 浏览器自动化 / API测试
目标网址: 任务执行的起始URL
描述: 任务的详细说明
标签: 用于分类和搜索的标签
```

#### 执行设置

```yaml
执行方式:
  - 立即执行: 创建后立即运行
  - 定时执行: 按照Cron表达式定时运行
  - 手动触发: 需要手动点击执行

Cron表达式示例:
  - "0 9 * * *": 每天上午9点
  - "0 */2 * * *": 每2小时执行一次
  - "0 9 * * 1-5": 工作日上午9点
  - "0 0 1 * *": 每月1号午夜
```

#### 高级设置

```yaml
超时设置: 任务最大执行时间（秒）
重试次数: 失败后的重试次数
重试间隔: 重试之间的等待时间
并发限制: 是否独占浏览器实例
环境变量: 任务执行时的环境变量
通知设置: 成功/失败时的通知配置
```

### 任务操作

#### 创建任务

1. **使用界面创建**
   - 点击"任务管理" → "创建任务"
   - 填写表单并保存

2. **使用命令行创建**
   ```bash
   php artisan task:create "任务名称" \
     --type=browser \
     --url="https://example.com" \
     --schedule="0 9 * * *"
   ```

#### 编辑任务

1. **基本编辑**
   - 在任务列表中点击"编辑"按钮
   - 修改配置后保存

2. **批量编辑**
   - 选择多个任务
   - 点击"批量操作" → "批量编辑"

#### 执行任务

1. **手动执行**
   - 点击任务列表中的"执行"按钮
   - 或在任务详情页点击"立即执行"

2. **定时执行**
   - 系统会根据Cron表达式自动执行
   - 可在"执行历史"中查看结果

#### 任务状态

- **启用**：任务正常运行
- **禁用**：任务暂停，不会自动执行
- **执行中**：任务正在运行
- **已完成**：任务执行成功
- **失败**：任务执行失败
- **超时**：任务执行超时

## 🔄 工作流编辑器

工作流编辑器是蜂鸟平台的核心功能，提供可视化的任务设计界面。

### 编辑器界面

```
┌─────────────────────────────────────────────────────────┐
│  工具栏: 保存 运行 调试 导入 导出                           │
├─────────────┬───────────────────────────┬───────────────┤
│             │                           │               │
│   节点面板   │        画布区域            │   属性面板     │
│             │                           │               │
│   - 开始     │     ┌─────┐              │   节点属性     │
│   - 动作     │     │开始 │              │   - 名称       │
│   - 条件     │     └─────┘              │   - 参数       │
│   - 结束     │        │                 │   - 条件       │
│             │     ┌─────┐              │               │
│             │     │动作 │              │               │
│             │     └─────┘              │               │
└─────────────┴───────────────────────────┴───────────────┘
```

### 节点类型详解

#### 1. 开始节点
- **作用**：工作流的入口点
- **配置**：
  - 初始URL
  - 浏览器设置
  - 环境变量

#### 2. 动作节点

**页面操作**
```yaml
访问页面:
  - URL: 目标网址
  - 等待加载: 页面加载完成的等待时间
  - 验证元素: 验证页面是否正确加载

点击元素:
  - 选择器: CSS选择器或XPath
  - 等待时间: 点击后的等待时间
  - 验证结果: 点击后的验证条件

输入文本:
  - 选择器: 输入框的选择器
  - 文本内容: 要输入的文本
  - 清空原内容: 是否先清空输入框
```

**数据操作**
```yaml
提取数据:
  - 选择器: 要提取数据的元素选择器
  - 提取类型: 文本/属性/HTML
  - 变量名: 存储数据的变量名

截图:
  - 截图类型: 全屏/元素/可视区域
  - 文件名: 截图文件名
  - 质量: 截图质量设置
```

#### 3. 条件节点
```yaml
条件类型:
  - 元素存在: 检查页面元素是否存在
  - 文本匹配: 检查文本是否匹配条件
  - 变量比较: 比较变量值
  - 自定义条件: JavaScript表达式

分支设置:
  - 真分支: 条件为真时的执行路径
  - 假分支: 条件为假时的执行路径
```

#### 4. 结束节点
- **作用**：工作流的结束点
- **配置**：
  - 结束状态：成功/失败
  - 返回数据：工作流的输出结果

### 工作流示例

#### 示例1：简单的网页数据采集

```
开始 → 访问页面 → 等待加载 → 提取标题 → 截图 → 结束
```

**配置详情**：
1. **开始节点**：设置目标网站URL
2. **访问页面**：导航到指定页面
3. **等待加载**：等待页面完全加载
4. **提取标题**：获取页面标题文本
5. **截图**：保存页面截图
6. **结束**：返回提取的数据

#### 示例2：带条件判断的登录流程

```
开始 → 访问登录页 → 输入用户名 → 输入密码 → 点击登录 
  → 检查登录状态 → [成功] → 截图 → 结束
                  → [失败] → 记录错误 → 结束
```

### 调试功能

#### 1. 单步执行
- 点击"调试"按钮
- 工作流会逐步执行每个节点
- 可以查看每步的执行结果

#### 2. 断点设置
- 在节点上右键选择"设置断点"
- 执行到断点时会暂停
- 可以检查当前状态和变量值

#### 3. 变量监控
- 在属性面板中查看变量值
- 实时监控变量变化
- 支持变量修改和测试

## 🌐 浏览器管理

### 浏览器池概念

蜂鸟平台使用浏览器池技术来管理Chrome实例，提高执行效率和资源利用率。

#### 池化优势
- **资源复用**：避免频繁启动关闭浏览器
- **并发执行**：支持多任务同时运行
- **负载均衡**：智能分配任务到空闲实例
- **故障恢复**：自动检测和恢复异常实例

### 浏览器实例状态

```yaml
状态类型:
  - 空闲 (idle): 实例可用，等待任务分配
  - 活跃 (active): 实例正在执行任务
  - 忙碌 (busy): 实例负载较高
  - 错误 (error): 实例出现异常
  - 离线 (offline): 实例不可用

实例信息:
  - 端口号: Chrome调试端口
  - 进程ID: 系统进程标识
  - 内存使用: 当前内存占用
  - CPU使用: 当前CPU占用
  - 运行时间: 实例运行时长
  - 任务计数: 已执行任务数量
```

### 浏览器配置

#### 全局配置
```yaml
池大小: 同时运行的浏览器实例数量
最大标签页: 每个实例的最大标签页数
实例超时: 实例空闲多久后回收
启动参数: Chrome启动参数
用户代理: 自定义User-Agent
窗口大小: 浏览器窗口尺寸
```

#### 任务级配置
```yaml
独占模式: 任务是否独占浏览器实例
无头模式: 是否以无头模式运行
代理设置: HTTP/HTTPS代理配置
Cookie管理: 是否启用Cookie管理
JavaScript: 是否启用JavaScript执行
图片加载: 是否加载图片资源
```

### 浏览器操作

#### 查看状态
```bash
# 命令行查看
php artisan browser:status

# 或在Web界面查看
浏览器管理 → 实例状态
```

#### 管理实例
```bash
# 启动浏览器池
php artisan browser:start --instances=5

# 停止所有实例
php artisan browser:stop

# 重启异常实例
php artisan browser:restart --unhealthy-only

# 清理僵尸进程
php artisan browser:cleanup
```

#### 健康检查
```bash
# 手动健康检查
php artisan browser:health-check

# 自动健康检查（通过定时任务）
*/10 * * * * php artisan browser:health-check
```

## 📊 监控与告警

### 监控指标

#### 系统监控
```yaml
CPU使用率:
  - 当前使用率
  - 平均使用率
  - 峰值使用率

内存使用:
  - 已用内存
  - 可用内存
  - 内存使用率

磁盘空间:
  - 总空间
  - 已用空间
  - 可用空间

网络状态:
  - 网络延迟
  - 带宽使用
  - 连接数量
```

#### 任务监控
```yaml
执行统计:
  - 总任务数
  - 成功任务数
  - 失败任务数
  - 成功率

性能指标:
  - 平均执行时间
  - 最长执行时间
  - 队列长度
  - 并发数量

错误分析:
  - 错误类型分布
  - 错误频率
  - 错误趋势
```

#### 浏览器监控
```yaml
实例状态:
  - 总实例数
  - 活跃实例数
  - 空闲实例数
  - 错误实例数

资源使用:
  - 内存使用情况
  - CPU使用情况
  - 标签页数量
  - 进程状态
```

### 告警配置

#### 告警规则
```yaml
CPU告警:
  - 阈值: 80%
  - 持续时间: 5分钟
  - 告警级别: 警告

内存告警:
  - 阈值: 85%
  - 持续时间: 3分钟
  - 告警级别: 严重

任务失败告警:
  - 失败率: 20%
  - 时间窗口: 1小时
  - 告警级别: 警告

浏览器异常告警:
  - 异常实例数: 2个
  - 检查间隔: 5分钟
  - 告警级别: 严重
```

#### 通知渠道

**邮件通知**
```yaml
配置:
  - SMTP服务器
  - 发送邮箱
  - 接收邮箱列表
  - 邮件模板

模板变量:
  - {alert_level}: 告警级别
  - {alert_message}: 告警消息
  - {timestamp}: 告警时间
  - {system_info}: 系统信息
```

**钉钉通知**
```yaml
配置:
  - Webhook地址
  - 安全密钥
  - 消息格式

消息类型:
  - 文本消息
  - Markdown消息
  - 链接消息
```

**企业微信通知**
```yaml
配置:
  - 企业ID
  - 应用Secret
  - 接收用户/部门

消息格式:
  - 文本消息
  - 图文消息
  - 文件消息
```

### 监控面板

#### 实时监控
- **系统概览**：CPU、内存、磁盘使用情况
- **任务状态**：正在执行的任务列表
- **浏览器状态**：实例运行状态
- **告警信息**：当前活跃告警

#### 历史数据
- **性能趋势**：系统性能历史图表
- **任务统计**：任务执行历史统计
- **错误分析**：错误类型和频率分析
- **资源使用**：资源使用历史趋势

#### 自定义面板
- **指标选择**：选择要显示的监控指标
- **时间范围**：设置数据查看时间范围
- **图表类型**：选择图表显示方式
- **刷新频率**：设置数据刷新间隔

## 👥 用户权限管理

### 角色体系

#### 预定义角色
```yaml
超级管理员 (Super Admin):
  - 系统完全控制权限
  - 用户和权限管理
  - 系统配置修改
  - 所有功能访问

管理员 (Admin):
  - 任务管理权限
  - 用户管理权限
  - 监控查看权限
  - 部分系统配置

操作员 (Operator):
  - 任务创建和执行
  - 执行历史查看
  - 基础监控查看
  - 个人设置修改

查看者 (Viewer):
  - 只读权限
  - 查看任务列表
  - 查看执行历史
  - 查看监控数据
```

#### 自定义角色
- **角色创建**：根据需要创建自定义角色
- **权限分配**：灵活分配功能权限
- **角色继承**：支持角色权限继承
- **动态调整**：运行时动态调整权限

### 权限详解

#### 功能权限
```yaml
任务管理:
  - tasks.view: 查看任务列表
  - tasks.create: 创建新任务
  - tasks.edit: 编辑任务配置
  - tasks.delete: 删除任务
  - tasks.execute: 执行任务

用户管理:
  - users.view: 查看用户列表
  - users.create: 创建新用户
  - users.edit: 编辑用户信息
  - users.delete: 删除用户
  - users.roles: 管理用户角色

系统管理:
  - system.config: 系统配置管理
  - system.monitor: 系统监控查看
  - system.logs: 系统日志查看
  - system.backup: 数据备份恢复
```

#### 数据权限
```yaml
数据范围:
  - 全部数据: 可以访问所有数据
  - 部门数据: 只能访问本部门数据
  - 个人数据: 只能访问个人创建的数据

数据操作:
  - 读取权限: 查看数据内容
  - 写入权限: 修改数据内容
  - 删除权限: 删除数据记录
  - 导出权限: 导出数据文件
```

### 用户管理

#### 用户创建
1. **基本信息**
   ```yaml
   用户名: 登录用户名
   邮箱: 用户邮箱地址
   姓名: 用户真实姓名
   部门: 所属部门
   职位: 工作职位
   ```

2. **账号设置**
   ```yaml
   密码: 登录密码
   状态: 启用/禁用
   过期时间: 账号过期时间
   登录限制: IP限制等
   ```

3. **角色分配**
   - 选择用户角色
   - 设置权限范围
   - 配置数据权限

#### 用户操作
```bash
# 命令行用户管理
php artisan user:create admin@example.com --name="管理员" --role=admin
php artisan user:list
php artisan user:disable user@example.com
php artisan user:reset-password user@example.com
```

### 审计日志

#### 日志记录
```yaml
操作记录:
  - 用户登录/登出
  - 任务创建/修改/删除
  - 系统配置变更
  - 权限变更操作

记录内容:
  - 操作时间
  - 操作用户
  - 操作类型
  - 操作对象
  - 操作结果
  - IP地址
  - 浏览器信息
```

#### 日志查询
- **时间范围**：按时间范围筛选
- **用户筛选**：按操作用户筛选
- **操作类型**：按操作类型筛选
- **关键词搜索**：全文搜索日志内容

## ⚙️ 系统设置

### 基础配置

#### 系统信息
```yaml
系统名称: 蜂鸟自动化平台
系统版本: v1.0.0
部署环境: 生产环境
系统时区: Asia/Shanghai
语言设置: 中文简体
```

#### 安全设置
```yaml
密码策略:
  - 最小长度: 8位
  - 复杂度要求: 包含大小写字母、数字、特殊字符
  - 过期时间: 90天
  - 历史密码: 不能重复最近5次密码

会话设置:
  - 会话超时: 2小时
  - 并发登录: 允许/禁止
  - 强制HTTPS: 启用/禁用
  - 记住登录: 7天
```

### 任务配置

#### 执行设置
```yaml
默认超时: 300秒
最大重试: 3次
重试间隔: 30秒
并发限制: 10个任务
队列优先级: 高/中/低
```

#### 存储设置
```yaml
截图存储:
  - 存储路径: storage/app/screenshots
  - 保留时间: 30天
  - 压缩质量: 80%
  - 文件格式: PNG/JPEG

日志存储:
  - 存储路径: storage/logs
  - 保留时间: 90天
  - 日志级别: DEBUG/INFO/WARNING/ERROR
  - 轮转大小: 100MB
```

### 通知配置

#### 邮件设置
```yaml
SMTP配置:
  - 服务器: smtp.gmail.com
  - 端口: 587
  - 加密: TLS
  - 用户名: your-email@gmail.com
  - 密码: your-app-password

发送设置:
  - 发件人名称: 蜂鸟自动化平台
  - 发件人邮箱: noreply@your-domain.com
  - 默认收件人: admin@your-domain.com
```

#### 消息模板
```yaml
任务成功模板:
  - 主题: 任务执行成功 - {task_name}
  - 内容: 任务 {task_name} 于 {execution_time} 执行成功

任务失败模板:
  - 主题: 任务执行失败 - {task_name}
  - 内容: 任务 {task_name} 于 {execution_time} 执行失败，错误信息：{error_message}
```

### 性能优化

#### 缓存设置
```yaml
缓存驱动: Redis
缓存前缀: fengniao_
默认TTL: 3600秒
标签缓存: 启用
```

#### 队列设置
```yaml
队列驱动: Redis
默认队列: default
高优先级队列: high
工作进程数: 2
最大执行时间: 3600秒
```

## ❓ 常见问题

### 安装和部署

**Q: Docker部署时提示端口被占用怎么办？**

A: 检查端口占用情况并修改配置：
```bash
# 检查端口占用
netstat -tlnp | grep :80

# 修改docker-compose.yml中的端口映射
ports:
  - "8080:80"  # 将80端口改为8080
```

**Q: 数据库连接失败怎么解决？**

A: 检查数据库配置和连接：
```bash
# 检查MySQL服务状态
sudo systemctl status mysql

# 测试数据库连接
mysql -u fengniao -p -h localhost

# 检查.env文件中的数据库配置
DB_HOST=mysql
DB_DATABASE=fengniao
DB_USERNAME=fengniao
DB_PASSWORD=your_password
```

### 任务执行

**Q: 任务执行失败，提示浏览器启动失败？**

A: 检查Chrome安装和权限：
```bash
# 检查Chrome安装
google-chrome --version

# 检查Chrome启动
google-chrome --headless --disable-gpu --dump-dom https://www.google.com

# 检查用户权限
sudo chown -R www-data:www-data /var/www/fengniao
```

**Q: 任务执行超时怎么办？**

A: 调整超时设置：
```yaml
# 在任务配置中增加超时时间
timeout: 600  # 10分钟

# 或在系统设置中修改默认超时
DEFAULT_TASK_TIMEOUT=600
```

**Q: 如何处理动态加载的页面元素？**

A: 使用等待策略：
```yaml
# 等待元素出现
wait_for_element:
  selector: ".dynamic-content"
  timeout: 30

# 等待页面加载完成
wait_for_page_load:
  timeout: 10
```

### 性能优化

**Q: 系统运行缓慢怎么优化？**

A: 从多个方面进行优化：
```bash
# 1. 增加浏览器池大小
BROWSER_POOL_SIZE=10

# 2. 优化数据库
php artisan db:optimize

# 3. 清理缓存
php artisan cache:clear
php artisan config:cache

# 4. 增加队列工作进程
php artisan queue:work --processes=4
```

**Q: 内存使用过高怎么处理？**

A: 监控和优化内存使用：
```bash
# 监控内存使用
php artisan monitor:memory

# 重启浏览器实例
php artisan browser:restart

# 调整PHP内存限制
memory_limit = 512M
```

### 监控告警

**Q: 告警通知收不到怎么办？**

A: 检查通知配置：
```bash
# 测试邮件通知
php artisan notification:test email

# 检查邮件配置
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password

# 查看通知日志
tail -f storage/logs/notifications.log
```

**Q: 如何自定义监控指标？**

A: 添加自定义监控：
```php
// 在监控服务中添加自定义指标
$monitor->addMetric('custom_metric', $value);

// 配置告警规则
$alert->addRule('custom_metric', '>', 100);
```

### 权限管理

**Q: 用户无法访问某些功能怎么办？**

A: 检查用户权限：
```bash
# 查看用户权限
php artisan user:permissions user@example.com

# 分配权限
php artisan user:assign-role user@example.com operator

# 检查角色权限
php artisan role:permissions operator
```

**Q: 如何批量管理用户？**

A: 使用批量操作：
```bash
# 批量创建用户
php artisan user:import users.csv

# 批量分配角色
php artisan user:batch-assign-role operator user1@example.com,user2@example.com

# 批量禁用用户
php artisan user:batch-disable inactive_users.txt
```

### 故障排除

**Q: 系统出现500错误怎么排查？**

A: 按步骤排查：
```bash
# 1. 查看错误日志
tail -f storage/logs/laravel.log

# 2. 检查文件权限
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

# 3. 清理缓存
php artisan config:clear
php artisan route:clear
php artisan view:clear

# 4. 检查环境配置
php artisan config:show
```

**Q: 队列任务不执行怎么办？**

A: 检查队列配置：
```bash
# 检查队列状态
php artisan queue:monitor

# 重启队列工作进程
php artisan queue:restart

# 检查失败任务
php artisan queue:failed

# 重试失败任务
php artisan queue:retry all
```

## 📞 获取更多帮助

如果本手册无法解决您的问题，请通过以下方式获取支持：

### 在线资源
- **官方文档**: [https://docs.fengniao.com](https://docs.fengniao.com)
- **API文档**: [https://api.fengniao.com](https://api.fengniao.com)
- **视频教程**: [https://video.fengniao.com](https://video.fengniao.com)

### 社区支持
- **GitHub Issues**: [https://github.com/your-org/fengniao/issues](https://github.com/your-org/fengniao/issues)
- **讨论区**: [https://github.com/your-org/fengniao/discussions](https://github.com/your-org/fengniao/discussions)
- **QQ群**: 123456789
- **微信群**: 扫描二维码加入

### 商业支持
- **邮件支持**: support@fengniao.com
- **电话支持**: +86-400-xxx-xxxx
- **在线客服**: 工作日 9:00-18:00

### 培训服务
- **在线培训**: 定期举办在线培训课程
- **现场培训**: 提供上门培训服务
- **定制培训**: 根据需求定制培训内容

---

感谢您使用蜂鸟自动化平台！我们致力于为您提供最好的自动化测试体验。
